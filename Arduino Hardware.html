<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Grid Wire Prototype</title>
<style>
*{box-sizing:border-box}
body{
  margin:0;
  font-family:Arial;
  background:#0b0f1a;
  color:white;
  overflow:hidden;
}

/* Topbar */
#topbar{
  height:60px;
  display:flex;
  background:#111;
  border-bottom:2px solid #222;
}
#top-logo{
  width:200px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:bold;
  background:#1a1a1a;
}
#nav{
  flex:1;
  display:flex;
  align-items:center;
  gap:20px;
  padding-left:20px;
}
#nav a{
  color:#aaa;
  text-decoration:none;
}
#nav a:hover{color:white}

/* Layout */
#container{
  display:flex;
  height:calc(100vh - 60px);
}

/* Sidebar */
#sidebar{
  width:200px;
  background:#111;
  border-right:2px solid #222;
  padding:10px;
}
#sidebar h3{
  margin-top:0;
}
.tool{
  background:#222;
  padding:8px;
  margin-top:8px;
  cursor:pointer;
  border-radius:4px;
}
.tool.active{background:#3498db}

/* Main */
#main{
  flex:1;
  display:flex;
  align-items:center;
  justify-content:center;
}

/* Canvas */
canvas{
  background:#000;
  border:2px solid #333;
  cursor:crosshair;
}
</style>
</head>
<body>

<div id="topbar">
  <div id="top-logo">LOGO</div>
  <div id="nav">
    <a href="#">Home</a>
    <a href="#">Editor</a>
    <a href="#">Docs</a>
  </div>
</div>

<div id="container">
  <div id="sidebar">
    <h3>Tools</h3>
    <div class="tool active" onclick="setTool('draw')">Draw Wire</div>
    <div class="tool" onclick="setTool('select')">Select</div>

    <h3 style="margin-top:20px">Sidebar</h3>
    <div>Work in progressâ€¦</div>
  </div>

  <div id="main">
    <canvas id="c" width="500" height="500"></canvas>
  </div>
</div>

<script>
const canvas = document.getElementById("c");
const ctx = canvas.getContext("2d");

const grid = 20;
let tool = "draw";
let items = [];
let selected = null;
let drawing = false;
let startPoint = null;
let mouse = null;

/* Tools */
function setTool(t){
  tool = t;
  document.querySelectorAll(".tool").forEach(b=>b.classList.remove("active"));
  event.target.classList.add("active");
}

/* Helpers */
function snap(v){ return Math.round(v/grid)*grid; }

function drawGrid(){
  ctx.strokeStyle="#111";
  for(let x=0;x<=500;x+=grid){
    ctx.beginPath();
    ctx.moveTo(x,0);
    ctx.lineTo(x,500);
    ctx.stroke();
  }
  for(let y=0;y<=500;y+=grid){
    ctx.beginPath();
    ctx.moveTo(0,y);
    ctx.lineTo(500,y);
    ctx.stroke();
  }
}

function drawWire(w,alpha=1){
  ctx.save();
  ctx.globalAlpha=alpha;
  ctx.translate(w.x,w.y);
  ctx.rotate(w.a*Math.PI/180);
  ctx.fillStyle="#f1c40f";
  ctx.fillRect(0,0,w.w*grid,w.h*grid);
  ctx.restore();
}

function hitTest(x,y){
  return items.find(w=>{
    return x>w.x && x<w.x+w.w*grid &&
           y>w.y && y<w.y+w.h*grid;
  });
}

/* Mouse */
canvas.onmousedown = e=>{
  const x = snap(e.offsetX);
  const y = snap(e.offsetY);

  if(tool==="draw"){
    drawing = true;
    startPoint = {x,y};
  }

  if(tool==="select"){
    selected = hitTest(e.offsetX,e.offsetY);
  }
};

canvas.onmouseup = e=>{
  if(tool==="draw" && drawing){
    const endX = snap(e.offsetX);
    const endY = snap(e.offsetY);

    const dx = endX - startPoint.x;
    const dy = endY - startPoint.y;

    const len = Math.max(1,Math.round(Math.sqrt(dx*dx+dy*dy)/grid));
    let angle = Math.atan2(dy,dx)*180/Math.PI;
    angle = Math.round(angle/90)*90;

    items.push({
      x:startPoint.x,
      y:startPoint.y,
      w:1,
      h:len,
      a:angle
    });

    drawing=false;
    startPoint=null;
    draw();
  }

  selected=null;
};

canvas.onmousemove = e=>{
  mouse=e;
  if(selected){
    selected.x = snap(e.offsetX);
    selected.y = snap(e.offsetY);
  }
  draw();
};

/* Draw loop */
function draw(){
  ctx.clearRect(0,0,500,500);
  drawGrid();

  items.forEach(w=>drawWire(w));

  // Ghost preview
  if(tool==="draw" && drawing && mouse){
    const dx = snap(mouse.offsetX)-startPoint.x;
    const dy = snap(mouse.offsetY)-startPoint.y;

    const len = Math.max(1,Math.round(Math.sqrt(dx*dx+dy*dy)/grid));
    let angle = Math.atan2(dy,dx)*180/Math.PI;
    angle = Math.round(angle/90)*90;

    let gx = startPoint.x + grid;
    let gy = startPoint.y + grid;

    if(Math.abs(angle-90)<5){
      gx = startPoint.x;
    }

    drawWire({
      x:gx,
      y:gy,
      w:1,
      h:len,
      a:angle
    },0.4);
  }
}

draw();
</script>
</body>
</html>
