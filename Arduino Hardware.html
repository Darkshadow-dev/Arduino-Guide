<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>2D Arduino Simulator</title>

<style>
body{margin:0;background:#111;color:white;font-family:Arial}
#top{padding:10px;background:#000}
#canvas{
  position:relative;
  width:900px;
  height:400px;
  margin:20px auto;
  border:2px solid #333;
  background:#1a1a1a;
}

/* COMPONENT */
.comp{
  position:absolute;
  cursor:move;
}
.comp img{width:60px}

/* SNAP NODE */
.node{
  position:absolute;
  width:14px;
  height:14px;
  border-radius:50%;
  background:red;
  border:2px solid white;
  transform:translate(-50%,-50%);
  cursor:pointer;
  z-index:5;
}

/* WIRE */
.wire{
  position:absolute;
  height:6px;
  background:#00e5ff;
  border-radius:6px;
  box-shadow:0 0 8px #00e5ff;
  transform-origin:0 50%;
  pointer-events:none;
}
</style>
</head>
<body>

<div id="top">
<select id="tool">
  <option value="">Add...</option>
  <option value="led">LED</option>
  <option value="wire">Wire</option>
</select>
</div>

<div id="canvas">
  <img src="Images/Arduino-uno.png" width="500" height="200">

  <!-- Arduino nodes -->
  <div class="node" id="pin13" style="left:420px; top:70px;"></div>
  <div class="node" id="gnd"   style="left:420px; top:110px;"></div>
</div>

<script>
const SNAP=15;
let nodes=[];
let wires=[];
let mode="";
let activeNode=null;
const canvas=document.getElementById("canvas");
const tool=document.getElementById("tool");

/* TOOL */
tool.onchange=e=>{
  mode=e.target.value;
}

/* ADD LED */
function addLED(){
  const led=document.createElement("div");
  led.className="comp";
  led.style.left="200px";
  led.style.top="200px";
  led.innerHTML='<img src="Images/LED.png">';
  canvas.appendChild(led);
  drag(led);

  // 2 legs
  makeNode(led,10,30).id="led-node-1";
  makeNode(led,50,30).id="led-node-2";
}

/* ADD NODE */
function makeNode(parent,x,y){
  const n=document.createElement("div");
  n.className="node";
  n.style.left=x+"px";
  n.style.top=y+"px";
  parent.appendChild(n);
  nodes.push(n);

  n.onclick=()=>{
    if(mode=="wire") startWire(n);
  }
  return n;
}

/* DRAG COMPONENT */
function drag(el){
  el.onmousedown=e=>{
    const ox=e.offsetX, oy=e.offsetY;
    document.onmousemove=m=>{
      el.style.left=(m.clientX-canvas.offsetLeft-ox)+"px";
      el.style.top=(m.clientY-canvas.offsetTop-oy)+"px";
      redraw();
    }
    document.onmouseup=()=>document.onmousemove=null;
  }
}

/* START WIRE */
function startWire(n){
  const w=document.createElement("div");
  w.className="wire";
  canvas.appendChild(w);

  const free=document.createElement("div");
  free.className="node";
  free.style.left=n.offsetLeft+"px";
  free.style.top=n.offsetTop+"px";
  canvas.appendChild(free);

  nodes.push(free);
  dragNode(free);
  wires.push({w,a:n,b:free});
}

/* DRAG FREE NODE */
function dragNode(n){
  n.onmousedown=e=>activeNode=n;
}

document.onmousemove=e=>{
  if(activeNode){
    activeNode.style.left=(e.clientX-canvas.offsetLeft)+"px";
    activeNode.style.top=(e.clientY-canvas.offsetTop)+"px";
    snap(activeNode);
    redraw();
  }
}
document.onmouseup=()=>activeNode=null;

/* SNAP */
function snap(n){
  nodes.forEach(p=>{
    if(p===n) return;
    const dx=p.offsetLeft-n.offsetLeft;
    const dy=p.offsetTop-n.offsetTop;
    if(Math.hypot(dx,dy)<SNAP){
      n.style.left=p.offsetLeft+"px";
      n.style.top=p.offsetTop+"px";
    }
  });
}

/* REDRAW */
function redraw(){
  wires.forEach(w=>{
    const a=w.a,b=w.b;
    const ax=a.offsetLeft, ay=a.offsetTop;
    const bx=b.offsetLeft, by=b.offsetTop;
    const dx=bx-ax, dy=by-ay;
    const len=Math.hypot(dx,dy);
    const ang=Math.atan2(dy,dx)*180/Math.PI;
    w.w.style.left=ax+"px";
    w.w.style.top=ay+"px";
    w.w.style.width=len+"px";
    w.w.style.transform=`rotate(${ang}deg)`;
  });
}

/* CONNECTION CHECK */
function isConnected(id1,id2){
  const a=document.getElementById(id1);
  const b=document.getElementById(id2);
  if(!a||!b) return false;
  return Math.hypot(
    a.offsetLeft-b.offsetLeft,
    a.offsetTop-b.offsetTop
  )<2;
}

/* LED LOGIC */
setInterval(()=>{
  if(
    isConnected("pin13","led-node-1") &&
    isConnected("gnd","led-node-2")
  ){
    console.log("LED ON");
  }
},500);

/* TOOL ACTION */
tool.onchange=e=>{
  mode=e.target.value;
  if(mode=="led") addLED();
}
</script>
</body>
</html>
