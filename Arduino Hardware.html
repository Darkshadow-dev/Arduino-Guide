<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Arduino Canvas Simulator</title>
<style>
body {
  margin: 0;
  background: #1e1e1e;
  color: white;
  font-family: monospace;
}
#sidebar {
  width: 200px;
  height: 100vh;
  background: #111;
  position: fixed;
  left: 0;
  top: 0;
  padding: 10px;
}
.btn {
  background: #222;
  border: 1px solid #555;
  padding: 8px;
  margin-bottom: 10px;
  cursor: pointer;
  text-align: center;
}
canvas {
  margin-left: 200px;
  background: #2a2a2a;
}
</style>
</head>

<body>

<div id="sidebar">
  <div class="btn" onclick="spawn('led')">LED</div>
  <div class="btn" onclick="spawn('resistor')">Resistor</div>
  <div class="btn" onclick="spawn('wire')">Wire</div>
</div>

<canvas id="c" width="1200" height="700"></canvas>

<script>
const ctx = c.getContext("2d");

let pins = [];
let parts = [];
let wires = [];
let drag = null;

// ---------- LOAD IMAGES ----------
const imgLED = new Image();
imgLED.src = "led.png";

const imgRes = new Image();
imgRes.src = "resistor.png";

// ---------- ARDUINO PIN MAP ----------
function createPins() {
  let x = 500;
  let y = 150;

  // Digital 0–13
  for (let i = 0; i <= 13; i++) {
    pins.push({
      name: "D" + i,
      x: x,
      y: y + i * 25
    });
  }

  // Power pins
  let py = y + 14 * 25 + 20;
  ["GND", "5V", "3V3", "VIN"].forEach(p => {
    pins.push({ name: p, x: x, y: py });
    py += 25;
  });

  // Analog A0–A5
  let ax = x + 200;
  let ay = y;
  for (let i = 0; i <= 5; i++) {
    pins.push({
      name: "A" + i,
      x: ax,
      y: ay + i * 25
    });
  }
}

// ---------- SPAWN PARTS ----------
function spawn(type) {
  parts.push({
    type,
    x: 200,
    y: 200,
    rot: 0
  });
}

// ---------- DRAW ----------
function draw() {
  ctx.clearRect(0, 0, c.width, c.height);

  // Arduino body
  ctx.fillStyle = "#00695c";
  ctx.fillRect(450, 120, 300, 420);

  // Pins
  ctx.fillStyle = "yellow";
  pins.forEach(p => {
    ctx.beginPath();
    ctx.arc(p.x, p.y, 5, 0, Math.PI * 2);
    ctx.fill();
    ctx.fillText(p.name, p.x - 40, p.y + 4);
  });

  // Wires
  ctx.strokeStyle = "#2196f3";
  ctx.lineWidth = 3;
  wires.forEach(w => {
    ctx.beginPath();
    ctx.moveTo(w.x1, w.y1);
    ctx.lineTo(w.x2, w.y2);
    ctx.stroke();
  });

  // Parts
  parts.forEach(p => {
    ctx.save();
    ctx.translate(p.x, p.y);
    ctx.rotate(p.rot);

    if (p.type === "led")
      ctx.drawImage(imgLED, -20, -10, 40, 20);

    if (p.type === "resistor")
      ctx.drawImage(imgRes, -30, -8, 60, 16);

    if (p.type === "wire") {
      ctx.strokeStyle = "#90caf9";
      ctx.beginPath();
      ctx.moveTo(-50, 0);
      ctx.lineTo(50, 0);
      ctx.stroke();
    }

    ctx.restore();
  });

  requestAnimationFrame(draw);
}

// ---------- MOUSE ----------
c.onmousedown = e => {
  const r = c.getBoundingClientRect();
  const mx = e.clientX - r.left;
  const my = e.clientY - r.top;

  parts.forEach(p => {
    if (Math.abs(mx - p.x) < 30 && Math.abs(my - p.y) < 20) {
      drag = p;
    }
  });
};

c.onmousemove = e => {
  if (!drag) return;
  const r = c.getBoundingClientRect();
  drag.x = e.clientX - r.left;
  drag.y = e.clientY - r.top;
};

c.onmouseup = () => drag = null;

// Rotate with R key
document.onkeydown = e => {
  if (e.key === "r" && drag) {
    drag.rot += Math.PI / 2;
  }
};

// ---------- START ----------
createPins();
draw();
</script>

</body>
</html>
