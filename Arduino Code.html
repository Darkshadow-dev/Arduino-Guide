<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Arduino Coding Place</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
<style>
body{
  margin:0;
  background:#111;
  color:white;
  font-family: Consolas, monospace;
}

/* MENU BAR */
.menu-bar{
  display:flex;
  background:#222;
  border-bottom:1px solid #333;
}

.menu{
  position:relative;
  padding:8px 14px;
  cursor:pointer;
}

.menu:hover{
  background:#333;
}

.dropdown{
  display:none;
  position:absolute;
  top:100%;
  left:0;
  background:#222;
  border:1px solid #333;
  min-width:160px;
  z-index:10;
}

.menu:hover .dropdown{
  display:block;
}

.dropdown button{
  width:100%;
  background:none;
  border:none;
  color:white;
  padding:8px;
  text-align:left;
  cursor:pointer;
}

.dropdown button:hover{
  background:#444;
}

/* CODE EDITOR */
#editor{
  width:100%;
  height:calc(100vh - 40px);
  background:#000;
  color:white;
  border:none;
  outline:none;
  padding:12px;
  font-size:14px;
  line-height:1.4;
  resize:none;
}

.editor-wrapper{
  position: relative;
  width: 100%;
  height: calc(100vh - 40px);
  background: black;
  font-family: Consolas, monospace;
}

/* Highlighted layer */
#highlight{
  position: absolute;
  inset: 0;
  padding: 12px;
  color: white;
  white-space: pre-wrap;
  word-wrap: break-word;
  pointer-events: none;
}

/* Editable layer */
#editor{
  position: absolute;
  inset: 0;
  background: transparent;
  color: transparent;          /* TEXT HIDDEN */
  caret-color: white;          /* CURSOR VISIBLE */
  border: none;
  outline: none;
  resize: none;
  padding: 12px;
  font-size: 14px;
  line-height: 1.4;
}
.comment{
  color: #3cff3c; /* green */
}

.err{
  color: #ff4b4b; /* red */
  font-weight: bold;
}

</style>

<!-- TOP MENU BAR -->
<div class="menu-bar">
  <div class="menu">File
    <div class="dropdown">
      <button onclick="newFile()">New</button>
      <button onclick="openFile()">Open</button>
      <button onclick="saveFile()">Save (.txt + .ino)</button>
    </div>
  </div>

  <div class="menu">Examples
    <div class="dropdown">
      <button onclick="loadExample('blink')">Blink</button>
      <button onclick="loadExample('button')">Button</button>
    </div>
  </div>

  <div class="menu">Help
    <div class="dropdown">
      <button onclick="alert('Arduino Coding Place v1')">About</button>
    </div>
  </div>
</div>

<!-- EDITOR -->
<div class="editor-wrapper">
  <pre id="highlight"></pre>
  <textarea id="editor" spellcheck="false"></textarea>
</div>

<input type="file" id="fileInput" accept=".txt,.ino" hidden>

<script>const editor = document.getElementById("editor");
const fileInput = document.getElementById("fileInput");

/* NEW FILE */
function newFile(){
  if(confirm("Clear editor?")){
    editor.value = "";
  }
}

/* OPEN FILE */
function openFile(){
  fileInput.click();
}

fileInput.onchange = () => {
  const file = fileInput.files[0];
  if(!file) return;

  const reader = new FileReader();
  reader.onload = e => {
    editor.value = e.target.result;
  };
  reader.readAsText(file);
};

/* SAVE BOTH .TXT AND .INO */
function saveFile(){
  const content = editor.value;

  saveAsFile(content, "sketch.txt");
  saveAsFile(content, "sketch.ino");
}

function saveAsFile(text, filename){
  const blob = new Blob([text], { type:"text/plain" });
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = filename;
  a.click();
  URL.revokeObjectURL(a.href);
}

const editor = document.getElementById("editor");
const highlight = document.getElementById("highlight");

editor.addEventListener("input", updateHighlight);
editor.addEventListener("scroll", syncScroll);

function syncScroll(){
  highlight.scrollTop = editor.scrollTop;
  highlight.scrollLeft = editor.scrollLeft;
}

function updateHighlight(){
  let code = editor.value;

  // Escape HTML
  code = code
    .replace(/&/g, "&amp;")
    .replace(/</g, "&lt;")
    .replace(/>/g, "&gt;");

  // ðŸ”´ Error words (very simple for now)
  code = code.replace(
    /\b(ERROR|TODO|!!!)\b/g,
    `<span class="err">$1</span>`
  );

  // ðŸŸ¢ Comments
  code = code.replace(
    /\/\/.*/g,
    `<span class="comment">$&</span>`
  );

  highlight.innerHTML = code;
}

// Initial render
updateHighlight();

/* EXAMPLES */
function loadExample(name){
  if(name === "blink"){
    editor.value = `
// Blink LED example
void setup(){
  pinMode(13, OUTPUT);
}

void loop(){
  digitalWrite(13, HIGH);
  delay(1000);
  digitalWrite(13, LOW);
  delay(1000);
}
`;
  }

  if(name === "button"){
    editor.value = `
// Button example
void setup(){
  pinMode(2, INPUT);
  pinMode(13, OUTPUT);
}

void loop(){
  if(digitalRead(2) == HIGH){
    digitalWrite(13, HIGH);
  }else{
    digitalWrite(13, LOW);
  }
}
`;
  }
}
</script>
</body>
</html>
